<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>{{ title or settings.app_name }}</title>
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap"
      rel="stylesheet"
    />
    <script>
      (function () {
        const root = document.documentElement;
        const cycle = ['light', 'dark', 'oled'];
        const apply = (mode, persist) => {
          root.classList.remove('dark', 'oled');
          if (mode === 'dark') {
            root.classList.add('dark');
          }
          if (mode === 'oled') {
            root.classList.add('dark');
            root.classList.add('oled');
          }
          root.dataset.theme = mode;
          if (persist) {
            localStorage.setItem('theme', mode);
          }
        };
        const savedTheme = localStorage.getItem('theme');
        const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
        const initial = cycle.includes(savedTheme) ? savedTheme : prefersDark ? 'dark' : 'light';
        apply(initial, false);
        window.__themeController = {
          apply: (mode) => apply(mode, true),
          current: () => root.dataset.theme || 'light',
          cycle,
        };
      })();
      window.tailwind = window.tailwind || {};
      window.tailwind.config = {
        darkMode: 'class',
        theme: {
          extend: {
            colors: {
              brand: {
                50: '#eef2ff',
                100: '#e0e7ff',
                200: '#c7d2fe',
                500: '#6366f1',
                600: '#4f46e5',
                700: '#4338ca',
              },
            },
            boxShadow: {
              focus: '0 0 0 3px rgba(99, 102, 241, 0.35)',
            },
          },
        },
      };
    </script>
    <script src="https://cdn.tailwindcss.com?plugins=forms,typography"></script>
    <link rel="stylesheet" href="/static/css/styles.css" />
  </head>
  <body class="bg-slate-100 dark:bg-slate-950 min-h-screen font-[Inter] text-slate-800 dark:text-slate-100 transition-colors">
    <nav class="bg-white dark:bg-slate-900/90 border-b border-slate-200 dark:border-slate-800 backdrop-blur">
      <div class="max-w-6xl mx-auto px-6 py-4 flex items-center justify-between">
        <div class="text-2xl font-semibold text-brand-600 dark:text-brand-400">{{ settings.app_name }}</div>
        <div class="flex items-center gap-4 text-sm font-medium text-slate-600 dark:text-slate-300">
          <a href="/" data-nav-index="0" class="hover:text-brand-600 dark:hover:text-brand-400">Dashboard</a>
          <a href="/what-if" data-nav-index="1" class="hover:text-brand-600 dark:hover:text-brand-400">What If</a>
          <a href="/settings" data-nav-index="2" class="hover:text-brand-600 dark:hover:text-brand-400">Settings</a>
          <a href="/debug" data-nav-index="3" class="hover:text-brand-600 dark:hover:text-brand-400">Debug</a>
          <a
            href="/docs"
            data-nav-index="4"
            class="hover:text-brand-600 dark:hover:text-brand-400"
            target="_blank"
            rel="noopener noreferrer"
            >API Docs</a
          >
          <button
            id="theme-toggle"
            type="button"
            class="ml-2 inline-flex items-center gap-2 rounded-full border border-slate-200 dark:border-slate-700 px-3 py-1 text-xs uppercase tracking-wide text-slate-500 dark:text-slate-300 hover:border-brand-500 focus:outline-none focus:ring-2 focus:ring-brand-500/60"
          >
            <span data-theme-icon class="text-base leading-none">‚òÄÔ∏è</span>
            <span data-theme-label>Light</span>
          </button>
        </div>
      </div>
    </nav>
    <main class="max-w-6xl mx-auto px-6 py-10">
      {% block content %}{% endblock %}
    </main>
    <footer class="max-w-6xl mx-auto px-6 py-6 text-sm text-slate-500 dark:text-slate-400">
      &copy; {{ current_year }} Inbox Steward. Made with local AI magic.
    </footer>
    <script>
      const themeToggle = document.getElementById('theme-toggle');
      const themeIcon = document.querySelector('[data-theme-icon]');
      const themeLabel = document.querySelector('[data-theme-label]');
      const controller = window.__themeController;
      const icons = { light: '‚òÄÔ∏è', dark: 'üåô', oled: 'üñ§' };
      const labels = { light: 'Light', dark: 'Dark', oled: 'OLED' };

      const updateThemeToggle = () => {
        if (!themeToggle || !controller) return;
        const current = controller.current();
        if (themeIcon) themeIcon.textContent = icons[current] || '‚òÄÔ∏è';
        if (themeLabel) themeLabel.textContent = labels[current] || current;
        themeToggle.setAttribute('aria-label', `Switch theme (current: ${labels[current] || current})`);
      };

      if (themeToggle && controller) {
        themeToggle.addEventListener('click', () => {
          const cycle = controller.cycle;
          const current = controller.current();
          const next = cycle[(cycle.indexOf(current) + 1) % cycle.length];
          controller.apply(next);
          updateThemeToggle();
        });
        updateThemeToggle();
      }

      const applyPageEnter = () => {
        const main = document.querySelector('main');
        if (!main) return;
        const direction = sessionStorage.getItem('page-transition-direction');
        sessionStorage.removeItem('page-transition-direction');
        const enterClass =
          direction === 'left'
            ? 'page-enter-left'
            : direction === 'right'
            ? 'page-enter-right'
            : 'page-enter-neutral';
        main.classList.add(enterClass);
        main.addEventListener(
          'animationend',
          () => {
            main.classList.remove('page-enter-left', 'page-enter-right', 'page-enter-neutral');
          },
          { once: true },
        );
      };

      document.addEventListener('DOMContentLoaded', applyPageEnter);

      const navLinks = Array.from(document.querySelectorAll('nav a[data-nav-index]'));
      const currentPath = window.location.pathname.replace(/\/+$/, '') || '/';
      const resolveIndex = (link) => {
        const value = link.getAttribute('data-nav-index');
        return value !== null ? Number.parseInt(value, 10) : 0;
      };
      const currentIndex = navLinks.findIndex((link) => link.getAttribute('href') === currentPath);

      navLinks.forEach((link) => {
        link.addEventListener('click', (event) => {
          if (event.metaKey || event.ctrlKey || event.shiftKey || event.altKey) {
            return;
          }
          if (link.target === '_blank') {
            return;
          }
          const main = document.querySelector('main');
          if (!main) {
            return;
          }
          if (link.getAttribute('href') === window.location.pathname) {
            return;
          }
          const targetIndex = resolveIndex(link);
          if (currentIndex === -1 || Number.isNaN(targetIndex) || targetIndex === currentIndex) {
            return;
          }
          event.preventDefault();
          const direction = targetIndex < currentIndex ? 'left' : 'right';
          sessionStorage.setItem('page-transition-direction', direction);
          main.classList.add(direction === 'left' ? 'page-exit-left' : 'page-exit-right');
          setTimeout(() => {
            window.location.href = link.href;
          }, 200);
        });
      });
    </script>
  </body>
</html>
