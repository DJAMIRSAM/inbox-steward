version: "3.9"
services:
  app:
    build: .
    container_name: inbox-steward
    restart: unless-stopped
    environment:
      APP_NAME: "${APP_NAME:-Inbox Steward}"
      LOG_LEVEL: "${LOG_LEVEL:-INFO}"
      INBOX_STEWARD_PORT: "${INBOX_STEWARD_PORT:-8003}"
      DATABASE_URL: "${DATABASE_URL:-postgresql+psycopg2://inbox_steward:inbox_steward@db:5432/inbox_steward}"
      IMAP_HOST: "${IMAP_HOST:-outlook.office365.com}"
      IMAP_PORT: "${IMAP_PORT:-993}"
      IMAP_USERNAME: "${IMAP_USERNAME:-example@outlook.com}"
      IMAP_PASSWORD: "${IMAP_PASSWORD:-getanapppassword}"
      IMAP_MAILBOX: "${IMAP_MAILBOX:-INBOX}"
      TIMEZONE: "${TIMEZONE:-America/Vancouver}"
      POLL_INTERVAL_SECONDS: "${POLL_INTERVAL_SECONDS:-120}"
      FULL_SORT_INTERVAL_MINUTES: "${FULL_SORT_INTERVAL_MINUTES:-180}"
      OLLAMA_ENDPOINT: "${OLLAMA_ENDPOINT:-http://ollama.local/:11434}"
      OLLAMA_MODEL: "${OLLAMA_MODEL:-gpt-oss:20b}"
      HOME_ASSISTANT_BASE_URL: "${HOME_ASSISTANT_BASE_URL:-http://homeassistant.local:8123}"
      HOME_ASSISTANT_TOKEN: "${HOME_ASSISTANT_TOKEN:-tokenhere}"
      HOME_ASSISTANT_MOBILE_TARGET: "${HOME_ASSISTANT_MOBILE_TARGET:-notify.mobile_app}"
      PDF_TEMP_DIR: "${PDF_TEMP_DIR:-/data/pdfs}"
    ports:
      - "${INBOX_STEWARD_PORT:-8003}:8000"
    volumes:
      - ./storage/pdfs:/data/pdfs
    depends_on:
      - db
    networks:
      - inbox-steward

  db:
    image: postgres:15-alpine
    container_name: inbox-steward-db
    restart: unless-stopped
    environment:
      POSTGRES_USER: inbox_steward
      POSTGRES_PASSWORD: inbox_steward
      POSTGRES_DB: inbox_steward
    volumes:
      - db-data:/var/lib/postgresql/data
    networks:
      - inbox-steward

  redis:
    image: redis:7-alpine
    container_name: inbox-steward-redis
    restart: unless-stopped
    networks:
      - inbox-steward

networks:
  inbox-steward:
    driver: bridge

volumes:
  db-data:
